<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Lokaty</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.10/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.10/vfs_fonts.js"></script>
</head>
<body>
    <div class="logo-container">
        <img src="cropped-logo-FB-1.png" id="siteLogo" alt="Finance Brothers Logo" class="logo d-block mx-auto">
        <div class="zoom-controls">
            <button id="zoomInBtn" class="btn btn-sm" aria-label="Powiƒôksz">+</button>
            <button id="zoomOutBtn" class="btn btn-sm" aria-label="Pomniejsz">-</button>
            <button id="toggleDarkModeBtn" class="btn btn-sm" aria-label="Prze≈ÇƒÖcz tryb ciemny">üåô</button>
        </div>
    </div>
    <div class="container">
        <div class="form-section" id="formSection">
            <div class="header-row">
                <h4>Kalkulator Lokaty</h4>
            </div>
            <div class="form-container">
                <div class="form-wrapper">
                    <form id="lokatyForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="kwota" class="form-label">Kwota lokaty</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="kwota" min="100" max="10000000" step="100" value="10000">
                                    <span class="input-group-text">z≈Ç</span>
                                </div>
                                <input type="range" class="form-range" id="kwotaRange" min="100" max="10000000" step="100" value="10000">
                                <div class="sub-info" id="kwotaInfo">Minimalna kwota: 100 z≈Ç</div>
                            </div>
                            <div class="form-group">
                                <label for="okres" class="form-label">Okres lokaty</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="okres" min="1" max="120" step="1" value="12">
                                    <span class="input-group-text">m-cy</span>
                                </div>
                                <input type="range" class="form-range" id="okresRange" min="1" max="120" step="1" value="12">
                                <div class="sub-info" id="okresInfo">Maksymalnie: 120 miesiƒôcy</div>
                            </div>
                            <div class="form-group">
                                <label for="oprocentowanie" class="form-label">Oprocentowanie</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="oprocentowanie" min="0.1" max="20" step="0.1" value="5">
                                    <span class="input-group-text">%</span>
                                </div>
                                <input type="range" class="form-range" id="oprocentowanieRange" min="0.1" max="20" step="0.1" value="5">
                                <div class="sub-info" id="oprocentowanieInfo">Sta≈Çe oprocentowanie</div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="kapitalizacja" class="form-label">Kapitalizacja</label>
                                <select class="form-control" id="kapitalizacja">
                                    <option value="1">Miesiƒôczna</option>
                                    <option value="3">Kwartalna</option>
                                    <option value="6">P√≥≈Çroczna</option>
                                    <option value="12" selected>Roczna</option>
                                    <option value="koniec">Na koniec</option>
                                </select>
                                <div class="sub-info" id="kapitalizacjaInfo">Okres kapitalizacji</div>
                            </div>
                        </div>
                        <div class="form-row">
                            <button type="button" class="btn btn-primary" id="obliczBtn" aria-label="Oblicz wyniki lokaty">Oblicz</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="opis-container">
                <div class="lokaty-opis" id="lokatyOpis">
                    Kalkulator lokat pozwala obliczyƒá zysk z lokaty bankowej na podstawie kwoty, okresu, oprocentowania i czƒôstotliwo≈õci kapitalizacji odsetek.
                </div>
            </div>
            <div class="data-container">
                <div class="data-info"><strong>Dane z dnia:</strong> <span class="data-date"><strong>08.04.2025r.</strong></span></div>
            </div>
        </div>
        <div class="result-section" id="resultSection">
            <button id="generatePdfBtn" class="btn btn-primary btn-sm" aria-label="Generuj PDF z wynikami">Generuj PDF</button>
            <div class="result-header">
                <h4 id="resultHeader">Podsumowanie wynik√≥w</h4>
            </div>
            <button class="btn btn-secondary mb-3" onclick="showForm()" aria-label="Powr√≥t do edycji formularza">Powr√≥t do edycji</button>
            <div class="result-container">
                <div class="result-wrapper-chart">
                    <div class="chart-container">
                        <div class="chart">
                            <canvas id="lokatyChart" aria-label="Wykres ko≈Çowy wynik√≥w lokaty"></canvas>
                        </div>
                        <div class="chart-legend">
                            <div class="legend-item" data-index="0">
                                <div class="color-box" style="background-color: #28a745;" data-tooltip="" data-color="#28a745">
                                    <span class="value" id="valueKapital">-</span>
                                </div>
                                <span class="legend-text" id="legendKapital">Kapita≈Ç</span>
                            </div>
                            <div class="legend-item" data-index="1">
                                <div class="color-box" style="background-color: #007bff;" data-tooltip="" data-color="#007bff">
                                    <span class="value" id="valueOdsetki">-</span>
                                </div>
                                <span class="legend-text" id="legendOdsetki">Odsetki</span>
                            </div>
                            <div class="legend-item" data-index="2">
                                <div class="color-box" style="background-color: #dc3545;" data-tooltip="" data-color="#dc3545">
                                    <span class="value" id="valuePodatek">-</span>
                                </div>
                                <span class="legend-text" id="legendPodatek">Podatek</span>
                            </div>
                        </div>
                    </div>
                    <div class="summary-footer">
                        <span class="highlight yellow" data-hover="" id="okresLokaty">-</span>
                        <span class="highlight green" data-hover="" id="zyskNetto">-</span>
                    </div>
                    <div class="lokaty-opis" id="lokatyOpisPodsumowanie">
                        Kalkulator lokat pozwala obliczyƒá zysk z lokaty bankowej na podstawie kwoty, okresu, oprocentowania i czƒôstotliwo≈õci kapitalizacji odsetek.
                    </div>
                </div>
            </div>
            <div class="harmonogram-container">
                <div class="result-wrapper-harmonogram">
                    <div class="harmonogram-chart-wrapper">
                        <div class="harmonogram">
                            <h5 class="btn-toggle" onclick="toggleHarmonogram('harmonogramContent')" aria-label="Prze≈ÇƒÖcz widoczno≈õƒá harmonogramu odsetek">Harmonogram odsetek ‚ñº</h5>
                            <div id="harmonogramContent">
                                <table class="table table-striped">
                                    <thead id="harmonogramNaglowek">
                                        <tr>
                                            <th>Okres</th>
                                            <th>Warto≈õƒá lokaty</th>
                                            <th>Oprocentowanie</th>
                                            <th>Odsetki</th>
                                            <th>Suma odsetek</th>
                                            <th>Podatek</th>
                                            <th>Zysk netto</th>
                                            <th>Suma netto</th>
                                        </tr>
                                    </thead>
                                    <tbody id="harmonogramTabela"></tbody>
                                </table>
                                <div class="harmonogram-opis" id="harmonogramOpis"></div>
                            </div>
                        </div>
                        <div class="chart-container-line">
                            <div class="chart-line">
                                <canvas id="lokatyChartLine" aria-label="Wykres liniowy warto≈õci lokaty w czasie"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        :root {
            --primary-bg: #f5f6f5;
            --primary-text: #333333;
            --secondary-bg: #ffffff;
            --accent-color: #c2b280;
            --accent-gradient-start: #c2b280;
            --accent-gradient-end: #b0a070;
            --border-color: #e0e0e0;
            --border-color-rgb: 102, 102, 102;
            --highlight-yellow: #17a2b8;
            --highlight-green: #28a745;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --logo-bg: #e9ecef;
            --input-bg: #fff;
            --input-group-bg: #f5f5f5;
            --range-track: #d3d3d3;
            --harmonogram-bg: #f9f9f9;
            --small-font-size: 0.7em;
            --border-radius: 5px;
            --range-bg: #e5e5e5;
        }

        .dark-mode {
            --primary-bg: #2b2b2b;
            --primary-text: #e0e0e0;
            --secondary-bg: #3a3a3a;
            --accent-color: #8b7d47;
            --accent-gradient-start: #8b7d47;
            --accent-gradient-end: #70673b;
            --border-color: #f5f5f5;
            --border-color-rgb: 245, 245, 245;
            --shadow-color: rgba(0, 0, 0, 0.5);
            --logo-bg: #3a3a3a;
            --input-bg: #3a3a3a;
            --input-group-bg: #666666;
            --range-track: #666666;
            --harmonogram-bg: #404040;
            --range-bg: #333333;
            --accent-gradient-start-black: #a3945c;
        }

        *,
        ::after,
        ::before {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            background-color: var(--primary-bg);
            font-family: 'Montserrat', sans-serif;
            font-size: var(--bs-body-font-size, 1rem);
            font-weight: var(--bs-body-font-weight, 400);
            line-height: var(--bs-body-line-height, 1.5);
            color: var(--primary-text);
            text-align: var(--bs-body-text-align, left);
            padding: 10px;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            --bs-gutter-x: 1.5rem;
            --bs-gutter-y: 0;
            width: 100%;
            padding: 15px calc(var(--bs-gutter-x) * 0.5);
            margin: 30px auto 0;
            max-width: 1200px;
            background: var(--secondary-bg);
            border-radius: 10px;
            box-shadow: 0 4px 6px var(--shadow-color);
        }

        .logo-container {
            background-color: var(--logo-bg);
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .zoom-controls {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 5px;
        }

        .logo,
        #siteLogo {
            max-width: 200px;
            margin-bottom: 0;
            cursor: pointer;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .header-row,
        .result-header {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
            position: relative;
        }

        .header-row h4,
        .result-header h4 {
            font-weight: 700;
            font-size: 1.2em;
            flex: 1;
            text-align: center;
            margin: 0;
        }

        .form-section {
            display: block;
            padding: 10px;
            position: relative;
        }

        .result-section {
            display: none;
            padding: 10px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .form-row {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            margin-bottom: 10px;
            gap: 15px;
            flex-wrap: wrap;
            text-align: left;
        }

        .form-group {
            flex: 1;
            min-width: 120px;
            max-width: 150px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }

        .form-label {
            font-size: var(--small-font-size);
            text-transform: uppercase;
            margin-bottom: 2px;
            text-align: left;
            width: 100%;
        }

        .form-control,
        .form-select {
            height: 22px;
            font-size: var(--small-font-size);
            padding: 2px;
            text-align: center;
            background: var(--input-bg);
            color: var(--primary-text);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-sizing: border-box;
            line-height: 18px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .form-control:focus,
        .form-select:focus {
            outline: none !important;
            box-shadow: 0 0 4px var(--accent-color);
            border-color: var(--border-color);
            background: var(--input-bg);
            color: var(--primary-text);
        }

        .input-group-text {
            height: 22px;
            font-size: var(--small-font-size);
            padding: 2px 5px;
            text-align: center;
            background: var(--input-group-bg);
            color: var(--primary-text);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-sizing: border-box;
            line-height: 18px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .input-group {
            width: 150px;
            display: flex;
            justify-content: center;
        }

        .form-select {
            max-width: 100px;
            appearance: none;
            background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAQ0lEQVR42mNgwAfKy8Q/Y//+Ii//3jVAYQzsIFyQ0dOaWq992zxcnN5+9NmyZACV40DmGhPZtzwUAxhUaoLntdha0DqQbtz4E9DzN6XgI0P2VYFlQrUwoQDIgbChLE/0awXiwV5rhugPX6A8BSsYFDqU+rEFdkGZA7+G9HMqaAU6l+0w+NdJD7ADhzhR/4KDZnWOw0QKrVqYc1G+1Dczfx8DR0uv+QJqDRvQxdizFAQAwsy39EZhAAAwAAJ4+Q1XFlAAAAABJRU5ErkJggg==') no-repeat right 5px center;
            padding: 0 20px 0 5px;
            line-height: 22px;
        }

        input[type="range"].form-range {
            margin-top: 5px;
            height: 6px;
            background: var(--input-group-bg);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            appearance: none;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
            outline: none;
        }

        input[type="range"].form-range::-webkit-slider-runnable-track {
            background: var(--input-group-bg);
            height: 6px;
            border-radius: var(--border-radius);
        }

        input[type="range"].form-range::-moz-range-track {
            background: var(--input-group-bg);
            height: 6px;
            border-radius: var(--border-radius);
        }

        input[type="range"].form-range::-ms-track {
            background: var(--input-group-bg);
            height: 6px;
            border-radius: var(--border-radius);
        }

        input[type="range"].form-range::-webkit-slider-thumb {
            background: var(--accent-gradient-start);
            width: 11px;
            height: 11px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            appearance: none;
            transform: translateY(2px);
        }

        input[type="range"].form-range::-moz-range-thumb {
            background: var(--accent-gradient-start);
            width: 11px;
            height: 11px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
        }

        input[type="range"].form-range::-ms-thumb {
            background: var(--accent-gradient-start);
            width: 11px;
            height: 11px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
        }

        .dark-mode input[type="range"].form-range::-webkit-slider-thumb {
            background: var(--accent-gradient-start-black);
        }

        .dark-mode input[type="range"].form-range::-moz-range-thumb,
        .dark-mode input[type="range"].form-range::-ms-thumb {
            background: var(--accent-gradient-start-black);
        }

        .sub-info {
            font-size: 0.4em;
            margin-top: 2px;
            text-align: left;
            align-self: flex-start;
            width: 100%;
        }

        .opis-container {
            margin-top: 20px;
            text-align: center;
            margin-bottom: 10px;
        }

        .lokaty-opis {
            font-size: 0.6em;
            text-align: center;
            max-width: 400px;
            margin: 10px auto 0;
            line-height: 1.4;
        }

        .data-container {
            text-align: right;
            margin-top: 5px;
        }

        .data-info,
        .data-date {
            font-size: 0.8em;
            color: var(--accent-color);
        }

        .data-date {
            font-size: 0.9em;
        }

        .result-container,
        .form-container,
        .harmonogram-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            position: relative;
        }

        .harmonogram-container {
            margin-top: 20px;
            padding: clamp(2px, 2vw, 20px);
            width: 100%;
            max-width: clamp(98%, 100vw, 1100px);
            margin-left: auto;
            margin-right: auto;
            box-sizing: border-box;
        }

        .harmonogram-chart-wrapper {
            background-color: var(--harmonogram-bg);
            padding: clamp(2px, 2vw, 20px);
            border-radius: 10px;
            width: 100%;
            max-width: clamp(98%, 100vw, 1100px);
            margin: 0 auto;
            box-sizing: border-box;
        }

        .result-wrapper-chart {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }

        .harmonogram {
            padding: 0;
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            overflow-x: auto;
        }

        .harmonogram table {
            margin: 0 auto;
            width: 100%;
            max-width: 100%;
            display: table;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 1px 3px var(--shadow-color);
            background: var(--harmonogram-bg);
            font-size: clamp(0.55em, 1.2vw, 0.8em);
            table-layout: auto;
        }

        .harmonogram th,
        .harmonogram td {
            text-align: center;
            white-space: normal;
            word-break: normal;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: clamp(0.3125em, 0.8125vw, 0.8125em);
        }

        .harmonogram th {
            background: linear-gradient(90deg, var(--accent-gradient-start), var(--accent-gradient-end));
            color: var(--primary-text);
            padding: clamp(1px, 0.5vw, 12px);
            vertical-align: middle;
            font-weight: 500;
            border-bottom: 2px solid var(--border-color);
            line-height: 1.2;
        }

        .harmonogram td {
            padding: clamp(1px, 0.5vw, 10px);
            font-weight: 400;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--harmonogram-bg);
            color: var(--primary-text);
            border-right: 1px solid rgba(var(--border-color-rgb), 0.3);
        }

        .harmonogram th:last-child,
        .harmonogram td:last-child {
            border-right: none;
        }

        .harmonogram .btn-toggle {
            cursor: pointer;
            font-size: 0.65em;
            text-decoration: underline;
            margin-bottom: 25px;
            position: relative;
            color: var(--primary-text);
        }

        .chart-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .chart {
            flex: 0 0 auto;
            width: 160px;
            height: 160px;
            position: relative;
            z-index: 25;
        }

        .chart-container-line {
            margin-top: 20px;
            width: 100%;
            max-width: clamp(98%, 100vw, 1100px);
            height: clamp(200px, 32vw, 400px);
            background-color: transparent;
            margin-left: auto;
            margin-right: auto;
        }

        .chart-line {
            width: 100%;
            height: 100%;
            font-size: clamp(0.3625em, 0.8125vw + 0.7px, 0.9125em);
        }

        .chart-legend {
            flex: 0 0 auto;
            max-width: 200px;
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .chart-legend .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            font-size: var(--small-font-size);
            cursor: pointer;
            transition: transform 0.3s ease;
            padding-left: 8px;
        }

        .chart-legend .legend-text {
            font-weight: bold;
            font-size: 14px;
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .chart-legend .color-box {
            width: 130px;
            min-width: 130px;
            height: 26px;
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: bold;
            line-height: 26px;
            font-size: 10px;
            white-space: nowrap;
            overflow: hidden;
            position: relative;
            color: #fff;
            margin-right: 6px;
        }

        .summary-footer {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 10px;
        }

        .highlight {
            font-size: 0.8em;
            padding: 4px 6px;
            border-radius: var(--border-radius);
            position: relative;
            cursor: pointer;
            color: #ffffff;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 210px;
        }

        .summary-footer .highlight {
            display: inline-block;
            width: clamp(200px, 20vw, 240px);
            max-width: 100%;
            margin: 2px 0;
            padding: clamp(5px, 1vw, 8px) clamp(8px, 2vw, 12px);
            font-weight: 500;
            font-size: clamp(0.525em, 1.05vw, 0.825em);
        }

        .highlight.yellow {
            background-color: var(--highlight-yellow);
        }

        .highlight.green {
            background-color: var(--highlight-green);
        }

        .btn-primary,
        .btn-secondary,
        #generatePdfBtn,
        .zoom-controls .btn {
            background: linear-gradient(135deg, var(--accent-gradient-start), var(--accent-gradient-end)) !important;
            border: none !important;
            color: var(--primary-text) !important;
            box-shadow: 0 4px 6px var(--shadow-color);
            transition: transform 0.2s ease, box-shadow 0.3s ease;
            border-radius: 25px;
            display: block;
            margin: 0 auto;
            transform: translateY(0);
        }

        .btn-primary:hover,
        .btn-secondary:hover,
        #generatePdfBtn:hover,
        .zoom-controls .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px var(--shadow-color);
            background: linear-gradient(135deg, var(--accent-gradient-end), var(--accent-gradient-start)) !important;
        }

        .dark-mode .btn-primary,
        .dark-mode .btn-secondary,
        .dark-mode #generatePdfBtn,
        .dark-mode .zoom-controls .btn {
            background: linear-gradient(135deg, var(--accent-gradient-start), var(--accent-gradient-end)) !important;
            color: #ffffff !important;
        }

        .dark-mode .btn-primary:hover,
        .dark-mode .btn-secondary:hover,
        .dark-mode #generatePdfBtn:hover,
        .dark-mode .zoom-controls .btn:hover {
            background: linear-gradient(135deg, var(--accent-gradient-end), var(--accent-gradient-start)) !important;
        }

        .btn-primary,
        .btn-secondary {
            font-size: 0.9em;
            padding: 8px 20px;
            margin: 25px auto 0;
        }

        #generatePdfBtn {
            margin: 0 0 15px auto;
            padding: 6px 15px;
        }

        .zoom-controls .btn {
            padding: 2px 8px;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const elements = {
            formSection: document.getElementById("formSection"),
            resultSection: document.getElementById("resultSection"),
            kwota: document.getElementById("kwota"),
            kwotaRange: document.getElementById("kwotaRange"),
            okres: document.getElementById("okres"),
            okresRange: document.getElementById("okresRange"),
            oprocentowanie: document.getElementById("oprocentowanie"),
            oprocentowanieRange: document.getElementById("oprocentowanieRange"),
            kapitalizacja: document.getElementById("kapitalizacja"),
            obliczBtn: document.getElementById("obliczBtn"),
            resultHeader: document.getElementById("resultHeader"),
            lokatyChart: document.getElementById("lokatyChart"),
            lokatyChartLine: document.getElementById("lokatyChartLine"),
            generatePdfBtn: document.getElementById("generatePdfBtn")
        };

        const state = {
            chart: null,
            chartLine: null,
            harmonogramData: [],
            lastFormData: {
                kwota: 10000,
                okres: 12,
                oprocentowanie: 5,
                kapitalizacja: "12"
            },
            isCalculating: false
        };

        elements.kwotaRange.addEventListener("input", () => { elements.kwota.value = elements.kwotaRange.value; });
        elements.kwota.addEventListener("input", () => { elements.kwotaRange.value = elements.kwota.value; });
        elements.okresRange.addEventListener("input", () => { elements.okres.value = elements.okresRange.value; });
        elements.okres.addEventListener("input", () => { elements.okresRange.value = elements.okres.value; });
        elements.oprocentowanieRange.addEventListener("input", () => { elements.oprocentowanie.value = elements.oprocentowanieRange.value; });
        elements.oprocentowanie.addEventListener("input", () => { elements.oprocentowanieRange.value = elements.oprocentowanie.value; });
        elements.obliczBtn.addEventListener("click", obliczLokate);
        elements.generatePdfBtn.addEventListener("click", generatePdf);

        function showForm() {
            elements.formSection.style.display = "block";
            elements.resultSection.style.display = "none";

            elements.kwota.value = state.lastFormData.kwota;
            elements.kwotaRange.value = state.lastFormData.kwota;
            elements.okres.value = state.lastFormData.okres;
            elements.okresRange.value = state.lastFormData.okres;
            elements.oprocentowanie.value = state.lastFormData.oprocentowanie;
            elements.oprocentowanieRange.value = state.lastFormData.oprocentowanie;
            elements.kapitalizacja.value = state.lastFormData.kapitalizacja;
        }

        function toggleHarmonogram(sectionId) {
            const content = document.getElementById(sectionId);
            const toggleBtn = content.previousElementSibling;
            content.style.display = content.style.display === "none" ? "block" : "none";
            toggleBtn.textContent = content.style.display === "none" ? "Harmonogram odsetek ‚ñ∫" : "Harmonogram odsetek ‚ñº";
        }

        function obliczLokate() {
            if (state.isCalculating) return;
            state.isCalculating = true;

            let kwota = parseFloat(elements.kwota.value) || 0;
            const maxKwota = 10000000;
            if (kwota > maxKwota) {
                kwota = maxKwota;
                elements.kwota.value = maxKwota;
                elements.kwotaRange.value = maxKwota;
                alert("Maksymalna warto≈õƒá to 10 000 000 z≈Ç.");
            }
            const okres = parseInt(elements.okres.value) || 0;
            const oprocentowanie = parseFloat(elements.oprocentowanie.value) || 0;
            const kapitalizacja = elements.kapitalizacja.value === "koniec" ? okres : parseInt(elements.kapitalizacja.value);
            const podatekBelki = 0.19;

            state.lastFormData = { kwota, okres, oprocentowanie, kapitalizacja: elements.kapitalizacja.value };

            if (kwota < 100 || okres <= 0 || oprocentowanie <= 0) {
                alert("Proszƒô wype≈Çniƒá wszystkie pola poprawnymi warto≈õciami.");
                state.isCalculating = false;
                return;
            }

            elements.resultHeader.textContent = `Wynik lokaty na ${okres} miesiƒôcy`;
            let kapital = kwota;
            let odsetkiCalkowite = 0;
            let zyskNettoCalkowity = 0;
            state.harmonogramData = [];

            const oprocentowanieMiesieczne = oprocentowanie / 100 / 12;
            const liczbaCykli = Math.floor(okres / (kapitalizacja === "koniec" ? okres : kapitalizacja));

            for (let i = 0; i <= liczbaCykli; i++) {
                const okresWiersz = i === 0 ? 0 : i * (kapitalizacja === "koniec" ? okres : kapitalizacja);
                let odsetkiCykl = i === 0 ? 0 : kapital * oprocentowanieMiesieczne * (kapitalizacja === "koniec" ? okres : kapitalizacja);
                let podatekCykl = odsetkiCykl * podatekBelki;
                let odsetkiNettoCykl = odsetkiCykl - podatekCykl;

                if (i > 0) {
                    odsetkiCalkowite += odsetkiCykl;
                    zyskNettoCalkowity += odsetkiNettoCykl;
                    kapital += odsetkiCykl;
                }

                state.harmonogramData.push({
                    okres: okresWiersz,
                    wartoscLokaty: kapital.toFixed(2),
                    oprocentowanie: `${oprocentowanie.toFixed(2)}%`,
                    odsetkiBrutto: odsetkiCykl.toFixed(2),
                    skumulowaneOdsetki: odsetkiCalkowite.toFixed(2),
                    podatek: podatekCykl.toFixed(2),
                    zyskNetto: odsetkiNettoCykl.toFixed(2),
                    sumaNetto: (kwota + zyskNettoCalkowity).toFixed(2)
                });
            }

            document.getElementById("valueKapital").textContent = `${kwota.toLocaleString('pl-PL', { minimumFractionDigits: 2 })} z≈Ç`;
            document.getElementById("valueOdsetki").textContent = `${odsetkiCalkowite.toLocaleString('pl-PL', { minimumFractionDigits: 2 })} z≈Ç`;
            document.getElementById("valuePodatek").textContent = `${(odsetkiCalkowite * podatekBelki).toLocaleString('pl-PL', { minimumFractionDigits: 2 })} z≈Ç`;
            document.getElementById("okresLokaty").textContent = `Okres lokaty: ${okres} miesiƒôcy`;
            document.getElementById("zyskNetto").textContent = `Zysk netto: ${zyskNettoCalkowity.toLocaleString('pl-PL', { minimumFractionDigits: 2 })} z≈Ç`;

            if (state.chart) state.chart.destroy();
            if (state.chartLine) state.chartLine.destroy();

            state.chart = new Chart(elements.lokatyChart.getContext("2d"), {
                type: 'doughnut',
                data: {
                    labels: ['Kapita≈Ç', 'Odsetki', 'Podatek'],
                    datasets: [{
                        data: [kwota, odsetkiCalkowite, odsetkiCalkowite * podatekBelki],
                        backgroundColor: ['#28a745', '#007bff', '#dc3545'],
                        borderWidth: 1,
                        hoverOffset: 20
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    cutout: '50%',
                    layout: { padding: 20 }
                }
            });

            let tabela = document.getElementById("harmonogramTabela");
            tabela.innerHTML = "";
            state.harmonogramData.forEach(wiersz => {
                tabela.innerHTML += `
                    <tr>
                        <td>${wiersz.okres}</td>
                        <td>${parseFloat(wiersz.wartoscLokaty).toLocaleString('pl-PL', { minimumFractionDigits: 2 })} z≈Ç</td>
                        <td>${wiersz.oprocentowanie}</td>
                        <td>${parseFloat(wiersz.odsetkiBrutto).toLocaleString('pl-PL', { minimumFractionDigits: 2 })} z≈Ç</td>
                        <td>${parseFloat(wiersz.skumulowaneOdsetki).toLocaleString('pl-PL', { minimumFractionDigits: 2 })} z≈Ç</td>
                        <td>${parseFloat(wiersz.podatek).toLocaleString('pl-PL', { minimumFractionDigits: 2 })} z≈Ç</td>
                        <td>${parseFloat(wiersz.zyskNetto).toLocaleString('pl-PL', { minimumFractionDigits: 2 })} z≈Ç</td>
                        <td>${parseFloat(wiersz.sumaNetto).toLocaleString('pl-PL', { minimumFractionDigits: 2 })} z≈Ç</td>
                    </tr>
                `;
            });

            const ctxLine = elements.lokatyChartLine.getContext("2d");
            const isDarkMode = document.body.classList.contains('dark-mode');
            state.chartLine = new Chart(ctxLine, {
                type: 'line',
                data: {
                    labels: state.harmonogramData.map(wiersz => `MiesiƒÖc ${wiersz.okres}`),
                    datasets: [
                        {
                            label: 'Zainwestowana kwota',
                            data: state.harmonogramData.map(() => kwota),
                            borderColor: '#8B7D47',
                            backgroundColor: 'rgba(139, 125, 71, 0.1)',
                            fill: false,
                            tension: 0,
                            borderWidth: 2
                        },
                        {
                            label: 'Warto≈õƒá lokaty',
                            data: state.harmonogramData.map(wiersz => parseFloat(wiersz.sumaNetto)),
                            borderColor: '#D4C791',
                            backgroundColor: 'rgba(212, 199, 145, 0.2)',
                            fill: true,
                            tension: 0.1,
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            title: { display: true, text: 'Okres (miesiƒÖce)', color: isDarkMode ? '#e0e0e0' : '#333333' },
                            ticks: { color: isDarkMode ? '#e0e0e0' : '#333333' },
                            grid: { color: isDarkMode ? '#666666' : '#e0e0e0', borderColor: isDarkMode ? '#e0e0e0' : '#333333' }
                        },
                        y: { 
                            title: { display: true, text: 'Warto≈õƒá (PLN)', color: isDarkMode ? '#e0e0e0' : '#333333' },
                            ticks: { color: isDarkMode ? '#e0e0e0' : '#333333' },
                            grid: { color: isDarkMode ? '#666666' : '#e0e0e0', borderColor: isDarkMode ? '#e0e0e0' : '#333333' }
                        }
                    },
                    plugins: { legend: { labels: { color: isDarkMode ? '#e0e0e0' : '#333333' } } }
                }
            });

            elements.formSection.style.display = "none";
            elements.resultSection.style.display = "block";
            state.isCalculating = false;
        }

        function generatePdf() {
            if (!state.harmonogramData.length) {
                alert("Najpierw oblicz wyniki lokaty, klikajƒÖc 'Oblicz'.");
                return;
            }

            const today = new Date().toLocaleDateString('pl-PL', { day: '2-digit', month: '2-digit', year: 'numeric' });
            const summary = [
                `Kapita≈Ç: ${parseFloat(state.lastFormData.kwota).toLocaleString('pl-PL', { minimumFractionDigits: 2 })} z≈Ç`,
                `Odsetki: ${parseFloat(state.harmonogramData[state.harmonogramData.length - 1].skumulowaneOdsetki).toLocaleString('pl-PL', { minimumFractionDigits: 2 })} z≈Ç`,
                `Podatek: ${parseFloat(state.harmonogramData[state.harmonogramData.length - 1].skumulowaneOdsetki * 0.19).toLocaleString('pl-PL', { minimumFractionDigits: 2 })} z≈Ç`,
                `Okres lokaty: ${state.lastFormData.okres} miesiƒôcy`,
                `Kapitalizacja: ${elements.kapitalizacja.options[elements.kapitalizacja.selectedIndex].text}`,
                `Zysk netto: ${parseFloat(state.harmonogramData[state.harmonogramData.length - 1].sumaNetto - state.lastFormData.kwota).toLocaleString('pl-PL', { minimumFractionDigits: 2 })} z≈Ç`
            ];

            const headers = ["Okres", "Warto≈õƒá lokaty", "Oprocentowanie", "Odsetki", "Suma odsetek", "Podatek", "Zysk netto", "Suma netto"];
            const tableData = state.harmonogramData.map(wiersz => [
                wiersz.okres.toString(),
                `${parseFloat(wiersz.wartoscLokaty).toLocaleString('pl-PL', { minimumFractionDigits: 2 })} z≈Ç`,
                wiersz.oprocentowanie,
                `${parseFloat(wiersz.odsetkiBrutto).toLocaleString('pl-PL', { minimumFractionDigits: 2 })} z≈Ç`,
                `${parseFloat(wiersz.skumulowaneOdsetki).toLocaleString('pl-PL', { minimumFractionDigits: 2 })} z≈Ç`,
                `${parseFloat(wiersz.podatek).toLocaleString('pl-PL', { minimumFractionDigits: 2 })} z≈Ç`,
                `${parseFloat(wiersz.zyskNetto).toLocaleString('pl-PL', { minimumFractionDigits: 2 })} z≈Ç`,
                `${parseFloat(wiersz.sumaNetto).toLocaleString('pl-PL', { minimumFractionDigits: 2 })} z≈Ç`
            ]);

            const columnWidths = headers.map(() => '*');
            const lineChartImage = elements.lokatyChartLine.toDataURL("image/png");

            const docDefinition = {
                pageSize: 'A4',
                pageMargins: [14.17, 60, 14.17, 20],
                header: { text: `Data: ${today}`, alignment: 'right', fontSize: 8, margin: [0, 10, 20, 0] },
                content: [
                    { text: `Wynik lokaty na ${state.lastFormData.okres} miesiƒôcy`, style: 'header' },
                    { text: "Podsumowanie:", style: 'sectionHeader', margin: [0, 10, 0, 5] },
                    { ul: summary.map(item => ({ text: item, style: 'listItem' })), margin: [0, 0, 0, 10] },
                    {
                        table: {
                            headerRows: 1,
                            widths: columnWidths,
                            body: [headers.map(h => ({ text: h, style: 'tableHeader' })), ...tableData]
                        },
                        layout: {
                            fillColor: function (rowIndex) { return (rowIndex === 0) ? '#C2B280' : (rowIndex % 2 === 0 ? '#F5F5F5' : null); },
                            hLineWidth: function () { return 0.5; },
                            vLineWidth: function () { return 0.5; },
                            paddingLeft: function () { return 1; },
                            paddingRight: function () { return 1; },
                            paddingTop: function () { return 2; },
                            paddingBottom: function () { return 2; }
                        },
                        margin: [0, 10, 0, 10]
                    },
                    { text: "Wykres liniowy warto≈õci lokaty w czasie", style: 'sectionHeader', margin: [0, 10, 0, 5] },
                    { image: lineChartImage, width: 500, height: 250, alignment: 'center', margin: [0, 5, 0, 0] }
                ],
                styles: {
                    header: { fontSize: 16, bold: true, alignment: 'center', margin: [0, 20, 0, 10] },
                    sectionHeader: { fontSize: 12, bold: true },
                    listItem: { fontSize: 10, margin: [0, 2, 0, 2] },
                    tableHeader: { fontSize: 8, bold: true, alignment: 'center', color: '#000000', fillColor: '#C2B280' },
                    tableCell: { fontSize: 8, alignment: 'center' }
                }
            };

            pdfMake.createPdf(docDefinition).download(`Wynik_lokaty_${today.replace(/\./g, '-')}.pdf`);
        }

        document.getElementById('siteLogo').addEventListener('click', () => {
            window.open('https://finance-brothers.pl', '_blank');
        });

        let currentZoom = 1;
        const zoomStep = 0.1;
        const minZoom = 0.5;
        const maxZoom = 2;

        function updateZoom() {
            const container = document.querySelector('.container');
            container.style.transform = `scale(${currentZoom})`;
            container.style.transformOrigin = 'top center';
        }

        document.getElementById("zoomInBtn").addEventListener("click", () => {
            if (currentZoom < maxZoom) {
                currentZoom = Math.min(maxZoom, currentZoom + zoomStep);
                updateZoom();
            }
        });

        document.getElementById("zoomOutBtn").addEventListener("click", () => {
            if (currentZoom > minZoom) {
                currentZoom = Math.max(minZoom, currentZoom - zoomStep);
                updateZoom();
            }
        });

        function toggleDarkMode() {
            const body = document.body;
            const isDarkMode = body.classList.contains('dark-mode');
            body.classList.toggle('dark-mode', !isDarkMode);
            body.classList.toggle('light-mode', isDarkMode);
            localStorage.setItem('theme', isDarkMode ? 'light' : 'dark');
            document.getElementById('toggleDarkModeBtn').textContent = isDarkMode ? 'üåô' : '‚òÄÔ∏è';

            if (state.chartLine) {
                const isDarkMode = document.body.classList.contains('dark-mode');
                state.chartLine.options.scales.x.title.color = isDarkMode ? '#e0e0e0' : '#333333';
                state.chartLine.options.scales.x.ticks.color = isDarkMode ? '#e0e0e0' : '#333333';
                state.chartLine.options.scales.y.title.color = isDarkMode ? '#e0e0e0' : '#333333';
                state.chartLine.options.scales.y.ticks.color = isDarkMode ? '#e0e0e0' : '#333333';
                state.chartLine.options.plugins.legend.labels.color = isDarkMode ? '#e0e0e0' : '#333333';
                state.chartLine.options.scales.x.grid.color = isDarkMode ? '#666666' : '#e0e0e0';
                state.chartLine.options.scales.y.grid.color = isDarkMode ? '#666666' : '#e0e0e0';
                state.chartLine.update();
            }
        }

        document.getElementById('toggleDarkModeBtn').addEventListener('click', toggleDarkMode);

        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-mode');
            document.getElementById('toggleDarkModeBtn').textContent = '‚òÄÔ∏è';
        } else {
            document.body.classList.add('light-mode');
            document.getElementById('toggleDarkModeBtn').textContent = 'üåô';
        }
    </script>
</body>
</html>
