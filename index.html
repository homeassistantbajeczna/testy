<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Kredytowy</title>
    <link rel="stylesheet" href="styles.css"> <!-- Twój CSS z kalkulatora obligacji -->
</head>
<body>
    <div class="calculator-container">
        <h1>Kalkulator Kredytowy</h1>
        <form id="creditForm">
            <div class="offer-box" id="offer-1">
                <h3>Oferta 1</h3>
                <div class="input-box">
                    <label>Kwota kredytu (PLN):</label>
                    <input type="number" class="loanAmount" required>
                </div>
                <div class="input-box">
                    <label>Oprocentowanie roczne (%):</label>
                    <input type="number" step="0.1" class="interestRate" required>
                </div>
                <div class="input-box">
                    <label>Okres spłaty (miesiące):</label>
                    <input type="number" class="loanTerm" required>
                </div>
                <div class="input-box">
                    <label>Rodzaj rat:</label>
                    <select class="rateType">
                        <option value="equal">Równe</option>
                        <option value="decreasing">Malejące</option>
                    </select>
                </div>
            </div>
            <button type="button" onclick="addOffer()">Dodaj kolejną ofertę</button>
            <button type="submit">Oblicz</button>
        </form>
        <div id="results">
            <table id="scheduleTable"></table>
            <canvas id="cashFlowChart"></canvas>
        </div>
        <button onclick="generatePDF()">Generuj PDF</button>
        <button onclick="toggleTheme()">Przełącz tryb jasny/ciemny</button>
        <button onclick="zoomIn()">Powiększ</button>
        <button onclick="zoomOut()">Pomniejsz</button>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Logika z kalkulatora kredytowego
        function calculateEqualRate(loanAmount, annualRate, termMonths) {
            const monthlyRate = annualRate / 100 / 12;
            const rate = loanAmount * monthlyRate * Math.pow(1 + monthlyRate, termMonths) /
                        (Math.pow(1 + monthlyRate, termMonths) - 1);
            return rate;
        }

        function calculateDecreasingRate(loanAmount, annualRate, termMonths, month) {
            const monthlyRate = annualRate / 100 / 12;
            const principal = loanAmount / termMonths;
            const remaining = loanAmount - (month - 1) * principal;
            return principal + remaining * monthlyRate;
        }

        function generateSchedule(loanAmount, annualRate, termMonths, rateType) {
            const schedule = [];
            let totalInterest = 0;
            let remaining = loanAmount;

            for (let i = 1; i <= termMonths; i++) {
                let rate, principal, interest;
                if (rateType === 'equal') {
                    rate = calculateEqualRate(loanAmount, annualRate, termMonths);
                    interest = remaining * (annualRate / 100 / 12);
                    principal = rate - interest;
                } else {
                    rate = calculateDecreasingRate(loanAmount, annualRate, termMonths, i);
                    principal = loanAmount / termMonths;
                    interest = rate - principal;
                }
                remaining -= principal;
                totalInterest += interest;
                schedule.push({ month: i, rate: rate.toFixed(2), principal: principal.toFixed(2), interest: interest.toFixed(2), remaining: remaining.toFixed(2) });
            }
            return { schedule, totalInterest };
        }

        // Porównywarka
        let offerCount = 1;
        function addOffer() {
            offerCount++;
            const newOffer = document.createElement('div');
            newOffer.classList.add('offer-box');
            newOffer.id = `offer-${offerCount}`;
            newOffer.innerHTML = `
                <h3>Oferta ${offerCount}</h3>
                <div class="input-box">
                    <label>Kwota kredytu (PLN):</label>
                    <input type="number" class="loanAmount" required>
                </div>
                <div class="input-box">
                    <label>Oprocentowanie roczne (%):</label>
                    <input type="number" step="0.1" class="interestRate" required>
                </div>
                <div class="input-box">
                    <label>Okres spłaty (miesiące):</label>
                    <input type="number" class="loanTerm" required>
                </div>
                <div class="input-box">
                    <label>Rodzaj rat:</label>
                    <select class="rateType">
                        <option value="equal">Równe</option>
                        <option value="decreasing">Malejące</option>
                    </select>
                </div>
            `;
            document.getElementById('creditForm').insertBefore(newOffer, document.querySelector('button[type="submit"]'));
        }

        // Obsługa formularza
        document.getElementById('creditForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const offers = [];
            document.querySelectorAll('.offer-box').forEach((box, index) => {
                const loanAmount = parseFloat(box.querySelector('.loanAmount').value);
                const interestRate = parseFloat(box.querySelector('.interestRate').value);
                const loanTerm = parseInt(box.querySelector('.loanTerm').value);
                const rateType = box.querySelector('.rateType').value;

                const { schedule, totalInterest } = generateSchedule(loanAmount, interestRate, loanTerm, rateType);
                const monthlyRate = rateType === 'equal' ? calculateEqualRate(loanAmount, interestRate, loanTerm).toFixed(2) : null;
                const totalCost = (loanAmount + totalInterest).toFixed(2);

                offers.push({ offer: `Oferta ${index + 1}`, schedule, monthlyRate, totalCost, totalInterest: totalInterest.toFixed(2) });
            });

            // Generowanie tabeli porównawczej
            let comparisonTable = `
                <table>
                    <tr>
                        <th>Oferta</th>
                        <th>Rata miesięczna (PLN)</th>
                        <th>Całkowity koszt (PLN)</th>
                        <th>Odsetki (PLN)</th>
                    </tr>`;
            offers.forEach(offer => {
                comparisonTable += `
                    <tr>
                        <td>${offer.offer}</td>
                        <td>${offer.monthlyRate || 'Zmienna'}</td>
                        <td>${offer.totalCost}</td>
                        <td>${offer.totalInterest}</td>
                    </tr>`;
            });
            comparisonTable += '</table>';

            // Generowanie harmonogramu dla pierwszej oferty (można rozszerzyć)
            const scheduleTable = `
                <table>
                    <tr>
                        <th>Miesiąc</th>
                        <th>Rata (PLN)</th>
                        <th>Kapitał (PLN)</th>
                        <th>Odsetki (PLN)</th>
                        <th>Pozostały dług (PLN)</th>
                    </tr>
                    ${offers[0].schedule.map(row => `
                        <tr>
                            <td>${row.month}</td>
                            <td>${row.rate}</td>
                            <td>${row.principal}</td>
                            <td>${row.interest}</td>
                            <td>${row.remaining}</td>
                        </tr>`).join('')}
                </table>`;

            document.getElementById('results').innerHTML = comparisonTable + scheduleTable;

            // Wykres (reużycie Chart.js z kalkulatora obligacji)
            const ctx = document.getElementById('cashFlowChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: offers[0].schedule.map(row => row.month),
                    datasets: [{
                        label: 'Odsetki',
                        data: offers[0].schedule.map(row => row.interest),
                        borderColor: '#007bff',
                        fill: false
                    }, {
                        label: 'Kapitał',
                        data: offers[0].schedule.map(row => row.principal),
                        borderColor: '#28a745',
                        fill: false
                    }]
                },
                options: { responsive: true }
            });
        });

        // Generowanie PDF (reużycie z kalkulatora obligacji)
        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text('Kalkulator Kredytowy - Wyniki', 10, 10);
            doc.autoTable({ html: '#scheduleTable', startY: 20 });
            doc.save('kalkulator_kredytowy.pdf');
        }

        // Funkcje UI z kalkulatora obligacji
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
        }

        let zoomLevel = 1;
        function zoomIn() {
            zoomLevel += 0.1;
            document.querySelector('.calculator-container').style.transform = `scale(${zoomLevel})`;
        }

        function zoomOut() {
            zoomLevel -= 0.1;
            document.querySelector('.calculator-container').style.transform = `scale(${zoomLevel})`;
        }
    </script>
</body>
</html>
